# é¾œé¦¬å±± goLine å¹³å° - é–‹ç™¼å°ˆæ¡ˆ

## å°ˆæ¡ˆæ¦‚è¿°

ã€Œé¾œé¦¬å±± goLine å¹³å°ã€æ˜¯ä¸€å€‹æ•´åˆ LINE ç™»å…¥çš„æ•¸ä½åŒ–ç®¡ç†ç³»çµ±,ç‚ºé¾œé¦¬å±±ç´«çš‡å¤©ä¹™çœŸæ…¶å®®æä¾›å¿—å·¥ç®¡ç†ã€å¥‰é¦™ç°½åˆ°ã€ç¥æœæœå‹™å’Œæ’ç­ç³»çµ±ã€‚

## æŠ€è¡“æ¶æ§‹

### å‰ç«¯
- **æ¡†æ¶**: HTML5 + JavaScript (ES6+)
- **éƒ¨ç½²**: Vercel (ä¸»è¦) / Firebase Hosting (å‚™æ´)
- **æ¨£å¼**: Noto Sans TC å­—å‹,éŸ¿æ‡‰å¼è¨­è¨ˆ

### å¾Œç«¯
- **å¹³å°**: Firebase Cloud Functions (Node.js 20)
- **è³‡æ–™åº«**: Firestore
- **èªè­‰**: Firebase Auth + LINE OAuth 2.0
- **å€åŸŸ**: asia-east2

### å››å€‹ Firebase å°ˆæ¡ˆ

| å°ˆæ¡ˆ | ID | ç”¨é€” | ç‹€æ…‹ |
|------|-----|------|------|
| Platform | platform-bc783 | ç™»å…¥ã€è§’è‰²ç®¡ç†ã€å…¬å‘Šã€å°æµ | âœ… å·²éƒ¨ç½² |
| Check-in | checkin-76c77 | GPS ç°½åˆ°ã€å·¡é‚é»ç®¡ç† | âœ… å·²éƒ¨ç½² |
| Service | service-b9d4a | ç¥æœæœå‹™ã€æ³•æœƒå ±å | å¾…é–‹ç™¼ |
| Schedule | schedule-48ff9 | å¿—å·¥æ’ç­ã€å‡ºå‹¤çµ±è¨ˆ | å¾…é–‹ç™¼ |

**æ³¨æ„**: Check-in å°ˆæ¡ˆå·²å¾ `checkin-29f7f`ï¼ˆå·²åˆªé™¤ï¼‰é·ç§»åˆ° `checkin-76c77`ï¼ˆ2025-10-31ï¼‰

## V3 æ¶æ§‹è®Šæ›´

### è§’è‰²ç³»çµ±å‡ç´šç‚ºé™£åˆ—
- **èˆŠç‰ˆ**: `role: "admin"` (å­—ä¸²)
- **æ–°ç‰ˆ**: `roles: ["user", "poweruser", "admin_checkin"]` (é™£åˆ—)

### æ–°å¢è§’è‰²
- `user` - ä¸€èˆ¬ä½¿ç”¨è€…
- `poweruser` - å¯å»ºç«‹æœå‹™å–®
- `admin_checkin` - ç°½åˆ°æ¨¡çµ„ç®¡ç†å“¡
- `admin_service` - ç¥æœæ¨¡çµ„ç®¡ç†å“¡
- `admin_schedule` - æ’ç­æ¨¡çµ„ç®¡ç†å“¡
- `superadmin` - ç³»çµ±è¶…ç´šç®¡ç†å“¡

## å°ˆæ¡ˆçµæ§‹

```
.
â”œâ”€â”€ public/                 # å‰ç«¯éœæ…‹æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html         # çµ±ä¸€ LINE Login å…¥å£ + æ¨¡çµ„é¸å–®
â”‚   â”œâ”€â”€ callback.html      # LINE OAuth å›èª¿è™•ç†
â”‚   â”œâ”€â”€ manage/            # å¾Œå°ç®¡ç†ç¸½è¦½
â”‚   â”‚   â””â”€â”€ index.html     # ç®¡ç†æ¨¡çµ„é¸å–®
â”‚   â”œâ”€â”€ checkin/           # å¥‰é¦™ç°½åˆ°æ¨¡çµ„ï¼ˆç¬¬ä¸€éšæ®µæ¨£æœ¬ï¼‰
â”‚   â”‚   â”œâ”€â”€ index.html     # ç°½åˆ°å‰ç«¯
â”‚   â”‚   â”œâ”€â”€ history.html   # ç°½åˆ°ç´€éŒ„
â”‚   â”‚   â”œâ”€â”€ manage/        # ç°½åˆ°å¾Œå°ï¼ˆç¬¬äºŒéšæ®µæ¨£æœ¬ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ index.html      # å¾Œå°å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard.html  # å„€è¡¨æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ patrol.html     # å·¡é‚é»ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ user.html       # ä½¿ç”¨è€…ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ js/            # ç°½åˆ° JavaScript
â”‚   â”‚   â””â”€â”€ styles/        # ç°½åˆ°æ¨£å¼
â”‚   â”œâ”€â”€ service/           # ç¥å‹™æœå‹™æ¨¡çµ„ï¼ˆç¬¬ä¸‰éšæ®µï¼‰
â”‚   â”‚   â”œâ”€â”€ index.html     # æœå‹™å‰ç«¯ï¼ˆæ¨£æ¿ï¼‰
â”‚   â”‚   â”œâ”€â”€ lightup.html   # ç·šä¸Šé»ç‡ˆé é¢ â­ NEW
â”‚   â”‚   â”œâ”€â”€ js/            # æœå‹™æ¨¡çµ„ JavaScript
â”‚   â”‚   â””â”€â”€ styles/        # æœå‹™æ¨¡çµ„æ¨£å¼
â”‚   â”œâ”€â”€ schedule/          # æ’ç­ç³»çµ±æ¨¡çµ„ï¼ˆç¬¬å››éšæ®µï¼‰
â”‚   â”‚   â””â”€â”€ index.html     # æ’ç­å‰ç«¯ï¼ˆæ¨£æ¿ï¼‰
â”‚   â”œâ”€â”€ js/                # å…±ç”¨ JavaScript
â”‚   â”‚   â”œâ”€â”€ firebase-init.js    # Firebase åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ auth.js            # LINE Login è™•ç†
â”‚   â”‚   â””â”€â”€ auth-guard.js      # å…±ç”¨èªè­‰æ¨¡çµ„ â­
â”‚   â””â”€â”€ styles/            # å…±ç”¨æ¨£å¼
â”‚       â””â”€â”€ common.css     # é€šç”¨æ¨£å¼
â”œâ”€â”€ docs/                  # ğŸ“š æ–‡ä»¶ä¸­å¿ƒ â­ å·²æ•´ç†
â”‚   â”œâ”€â”€ README.md          # æ–‡ä»¶ç´¢å¼•ç¸½è¦½
â”‚   â”œâ”€â”€ æ•™å­¸æ‰‹å†Š/          # å®Œæ•´æ•™å­¸ï¼ˆ00-13ç« ï¼‰
â”‚   â”œâ”€â”€ éƒ¨ç½²æŒ‡å—/          # Vercel éƒ¨ç½²æ–‡ä»¶
â”‚   â”œâ”€â”€ è¨­å®šæŒ‡å—/          # LINE/LIFF è¨­å®šæ–‡ä»¶
â”‚   â””â”€â”€ é–‹ç™¼æ–‡ä»¶/          # æŠ€è¡“é–‹ç™¼æ–‡ä»¶
â”œâ”€â”€ functions/             # Cloud Functions
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ platform/      # Platform Functions
â”‚   â”‚   â”‚   â””â”€â”€ index.js   # LINE OAuth + Custom Token
â”‚   â”‚   â”œâ”€â”€ checkin/       # Check-in Functions
â”‚   â”‚   â”‚   â””â”€â”€ index.js   # GPS ç°½åˆ°é©—è­‰
â”‚   â”‚   â”œâ”€â”€ service/       # Service Functions (å¾…é–‹ç™¼)
â”‚   â”‚   â””â”€â”€ schedule/      # Schedule Functions (å¾…é–‹ç™¼)
â”‚   â””â”€â”€ index.js           # Functions å…¥å£é»
â”œâ”€â”€ firebase.json          # Firebase é…ç½®
â””â”€â”€ package.json           # å°ˆæ¡ˆä¾è³´
```

## é–‹ç™¼ç’°å¢ƒ

### å·²å®‰è£
- Node.js 20.19.3
- Firebase Tools
- http-server (å‰ç«¯é–‹ç™¼ä¼ºæœå™¨)

### ç’°å¢ƒè®Šæ•¸ (Replit Secrets)
å°ˆæ¡ˆä½¿ç”¨ Replit Secrets ç®¡ç†æ•æ„Ÿè³‡è¨Š:
- Firebase å››å€‹å°ˆæ¡ˆçš„é…ç½® (apiKey, appId ç­‰)
- LINE Channel ID å’Œ Secret
- Service Account é‡‘é‘°

### æœ¬åœ°é–‹ç™¼
```bash
# å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨
npm run serve

# å•Ÿå‹• Firebase Emulator
npm run emulators
```

## åŠŸèƒ½æ¨¡çµ„ç‹€æ…‹

### âœ… ç¬¬ä¸€ã€äºŒéšæ®µå·²å®Œæˆï¼ˆæ¨£æœ¬ï¼‰
1. **çµ±ä¸€å¹³å°æ¶æ§‹**
   - LINE OAuth 2.0 ç™»å…¥å…¥å£
   - æ¨¡çµ„é¸å–®ç³»çµ±ï¼ˆè§’è‰²æ§åˆ¶ï¼‰
   - å¾Œå°ç®¡ç†ç¸½è¦½
   - å…±ç”¨èªè­‰å®ˆè¡› (auth-guard.js)

2. **Platform æ¨¡çµ„ (å¹³å°å±¤)**
   - LINE OAuth 2.0 ç™»å…¥æ•´åˆ
   - Firebase Auth èªè­‰
   - è§’è‰²å°å‘ç³»çµ±
   - updateUserRole Function (æ”¯æ´ roles é™£åˆ—)

2. **å¥‰é¦™ç°½åˆ°æ¨¡çµ„ï¼ˆå®Œæ•´æ¨£æœ¬ï¼‰**
   - **å‰ç«¯ï¼ˆç¬¬ä¸€éšæ®µï¼‰**:
     - GPS é›™æ¨¡å¼ç°½åˆ°ï¼ˆGPS + QR Codeï¼‰
     - å·¡é‚é»é¸æ“‡
     - ç°½åˆ°ç´€éŒ„æŸ¥è©¢
   - **å¾Œå°ï¼ˆç¬¬äºŒéšæ®µï¼‰**:
     - å„€è¡¨æ¿ï¼ˆçµ±è¨ˆåˆ†æã€CSV åŒ¯å‡ºï¼‰
     - å·¡é‚é»ç®¡ç†ï¼ˆCRUDã€æ¸¬è©¦æ¨¡å¼ã€QR Codeï¼‰
     - ä½¿ç”¨è€…ç®¡ç†ï¼ˆè§’è‰²æ¬Šé™ï¼‰

3. **Cloud Functions**
   - Platform: LINE Token Exchange + Custom Token
   - Check-in: GPS è·é›¢é©—è­‰ï¼ˆHaversineï¼‰

### ğŸ“‹ ç¬¬ä¸‰ã€å››éšæ®µå¾…é–‹ç™¼
- **Service æ¨¡çµ„ï¼ˆç¬¬ä¸‰éšæ®µï¼‰**
  - æ³•æœƒå ±åç³»çµ±
  - æœå‹™å–®ç®¡ç†
  - åƒèˆ‡çµ±è¨ˆ
- **Schedule æ¨¡çµ„ï¼ˆç¬¬å››éšæ®µï¼‰**
  - å¿—å·¥æ’ç­
  - å‡ºå‹¤çµ±è¨ˆ
  - ç­è¡¨èª¿æ•´

**æ³¨æ„**: Service å’Œ Schedule æ¨¡çµ„å·²é ç•™æ¶æ§‹ï¼Œå¯è¤‡è£½ Check-in æ¨£æ¿å¿«é€Ÿé–‹ç™¼

## ç”¨æˆ¶åå¥½

### é–‹ç™¼è¦ç¯„
- ä½¿ç”¨ç¹é«”ä¸­æ–‡è¨»è§£
- éµå¾ª V3 æ¶æ§‹ (roles é™£åˆ—)
- æ‰€æœ‰ API ä½¿ç”¨ Firebase ID Token é©—è­‰
- Functions éƒ¨ç½²åˆ° asia-east2 å€åŸŸ
- å‰ç«¯ä½¿ç”¨ ES6 æ¨¡çµ„èªæ³•

### è¨­è¨ˆè¦ç¯„
- ä¸»è‰²ç³»: ç´«ç´… (#8A2BE2)ã€é‡‘è‰² (#FFD700)
- å­—å‹: Noto Sans TC
- æ‰‹æ©Ÿå„ªå…ˆè¨­è¨ˆ (Mobile First)
- åœ“è§’ 12pxã€é™°å½± 2px

## éƒ¨ç½²è³‡è¨Š

### Staging (æ¸¬è©¦ç’°å¢ƒ)
- ç¶²å€: https://guimashan.vercel.app
- ç”¨é€”: æ•´åˆæ¸¬è©¦

### Production (æ­£å¼ç’°å¢ƒ)
- ç¶²å€: https://go.guimashan.org.tw
- Vercel åœ˜éšŠ: guimashan's projects
- Vercel å°ˆæ¡ˆ ID: prj_FwuUrTa2m4MaMocVnb2wAGB8CPyy

## LINE æ•´åˆè³‡è¨Š

### LINE Login (OAuth 2.0)
- Channel ID: 2008269293
- Channel Type: LINE Login
- Callback URLs: 
  - æ­£å¼: https://go.guimashan.org.tw/callback.html
  - å‚™ç”¨: https://guimashan.vercel.app/callback.html
  - æ¸¬è©¦: http://localhost:5000/callback.html

### LINE LIFF (Front-end Framework)
ä½¿ç”¨åŒä¸€å€‹ LINE Login Channel (2008269293)
- å¥‰é¦™ç°½åˆ° LIFF App: /liff/checkin.html
- ç¥å‹™æœå‹™ LIFF App: /liff/service.html
- æ’ç­ç³»çµ± LIFF App: /liff/schedule.html
- LIFF IDs: éœ€åœ¨ LINE Developers Console å»ºç«‹å¾Œæ›´æ–°

### LINE Messaging API (å®˜æ–¹å¸³è™Ÿ)
- éœ€å»ºç«‹ Messaging API Channel
- Webhook URL: https://asia-east2-platform-bc783.cloudfunctions.net/lineWebhook
- æ”¯æ´é—œéµå­—è§¸ç™¼ LIFF App

## æœ€è¿‘è®Šæ›´

### 2025-11-03 ç¥å‹™æœå‹™ç®¡ç†å¾Œå°å¯¦ä½œï¼ˆè¨‚å–®ç®¡ç†ç³»çµ±ï¼‰

**åŠŸèƒ½æ¦‚è¿°**:
- âœ… å»ºç«‹ service/manage/ å¾Œå°æ¶æ§‹
  - /service/manage/index.html - å¾Œå°å…¥å£ï¼ˆè§’è‰²æª¢æŸ¥ã€å°èˆªé¸å–®ï¼‰
  - /service/manage/orders.html - è¨‚å–®ç®¡ç†é é¢
  - /service/manage/js/orders.js - è¨‚å–®ç®¡ç†é‚è¼¯
  - /service/manage/styles/manage.css - å¾Œå°æ¨£å¼

**è¨‚å–®ç®¡ç†åŠŸèƒ½**:
- âœ… è¨‚å–®åˆ—è¡¨é¡¯ç¤º
  - é¡¯ç¤ºæœ€è¿‘ 100 ç­†è¨‚å–®
  - ç‹€æ…‹æ¨™ç±¤ï¼ˆpending, paid_offlineï¼‰
  - é‡‘é¡é¡¯ç¤ºèˆ‡æ™‚é–“æˆ³è¨˜
- âœ… è¨‚å–®è©³æƒ…æŸ¥çœ‹
  - Modal å½ˆçª—é¡¯ç¤ºå®Œæ•´è¨‚å–®è³‡æ–™
  - **ä¿¡ç”¨å¡è³‡è¨Šé¡¯ç¤º**ï¼ˆå¡è™Ÿã€æŒå¡äººã€æœ‰æ•ˆæœŸé™ã€CVVï¼‰
  - å ±åäººè³‡è¨Šï¼ˆå§“åã€é›»è©±ã€åœ°å€ï¼‰
  - ç‡ˆåº§é¸æ“‡èˆ‡å‚™è¨»
- âœ… æ‰‹å‹•ç¢ºèªæ”¶æ¬¾
  - ä¸€éµç¢ºèªä»˜æ¬¾ç‹€æ…‹
  - è‡ªå‹•åˆªé™¤æ©Ÿå¯†ä¿¡ç”¨å¡è³‡æ–™
  - è¨˜éŒ„ç¢ºèªäººå“¡èˆ‡æ™‚é–“

**å¾Œç«¯ API (å·²éƒ¨ç½²åˆ° service-b9d4a)**:
- âœ… `getRegistrations` - æŸ¥è©¢è¨‚å–®åˆ—è¡¨
- âœ… `getRegistrationDetail` - æŸ¥çœ‹è¨‚å–®è©³æƒ…ï¼ˆå«ä¿¡ç”¨å¡ï¼‰
- âœ… `confirmPayment` - ç¢ºèªæ”¶æ¬¾ä¸¦åˆªé™¤æ©Ÿå¯†è³‡æ–™

**ä¸‰å±¤å®‰å…¨æ¶æ§‹**:
1. **å‰ç«¯æ¬Šé™æª¢æŸ¥** (auth-guard.js)
   - æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦ç™»å…¥
   - é©—è­‰æ˜¯å¦å…·æœ‰ poweruser_serviceã€admin_service æˆ– superadmin è§’è‰²
   - æœªæˆæ¬Šä½¿ç”¨è€…ç„¡æ³•å­˜å–ç®¡ç†é é¢
   
2. **å¾Œç«¯ä¼ºæœå™¨ç«¯é©—è­‰** (checkServiceRole å‡½æ•¸)
   - è·¨å°ˆæ¡ˆæŸ¥è©¢ï¼šå¾ platform-bc783/users è®€å–ä½¿ç”¨è€…è§’è‰²
   - ä½¿ç”¨ Admin SDK ç¢ºä¿è³‡æ–™çœŸå¯¦æ€§
   - æ‰€æœ‰ç®¡ç† API éƒ½å¿…é ˆé€šéè§’è‰²æª¢æŸ¥æ‰èƒ½åŸ·è¡Œ
   
3. **Firestore Security Rules å®Œå…¨é–å®š**
   - æ‰€æœ‰é›†åˆç¦æ­¢ç›´æ¥è®€å¯«ï¼ˆallow read, write: if falseï¼‰
   - å¼·åˆ¶æ‰€æœ‰æ“ä½œå¿…é ˆé€šé Cloud Functions
   - é˜²æ­¢ä½¿ç”¨è€…ç¹é API ç›´æ¥å­˜å–è³‡æ–™

**å®‰å…¨è€ƒé‡èˆ‡æœªä¾†æ”¹é€²**:
- âš ï¸ ç›®å‰æ¶æ§‹ï¼šä½¿ç”¨è·¨å°ˆæ¡ˆ Firestore æŸ¥è©¢ä¾†é©—è­‰è§’è‰²
  - å„ªé»ï¼šé›†ä¸­ç®¡ç†è§’è‰²ï¼ˆplatform-bc783/usersï¼‰
  - ä¾è³´ï¼šplatform å°ˆæ¡ˆçš„ updateUserRole å¿…é ˆæœ‰æ­£ç¢ºçš„æ¬Šé™æ§åˆ¶
- ğŸ¯ å»ºè­°æœªä¾†å‡ç´šç‚º Custom Claims
  - åœ¨ Firebase Auth Token ä¸­ç›´æ¥åŒ…å«è§’è‰²è³‡è¨Š
  - æ›´å®‰å…¨ï¼Œç„¡éœ€é¡å¤–æŸ¥è©¢
  - éœ€è¦ä¿®æ”¹ platform å°ˆæ¡ˆçš„ç™»å…¥æµç¨‹

**ç›¸é—œæª”æ¡ˆ**:
- å‰ç«¯ï¼špublic/service/manage/index.htmlã€orders.htmlã€js/orders.js
- å¾Œç«¯ï¼šfunctions/src/service/index.js (checkServiceRole + ç®¡ç† API)
- å…±ç”¨ï¼špublic/js/auth-guard.js

### 2025-11-03 ç·šä¸Šé»ç‡ˆä¿¡ç”¨å¡æ”¶é›†åŠŸèƒ½å¯¦ä½œï¼ˆéæ¸¡æ–¹æ¡ˆï¼‰

âš ï¸ **é‡è¦å®‰å…¨è­¦å‘Š**: æ­¤æ–¹æ¡ˆç‚ºéæ¸¡æœŸè§£æ±ºæ–¹æ¡ˆï¼Œè¤‡è£½èˆŠç³»çµ±æµç¨‹ä»¥ä¾¿å¿«é€Ÿä¸Šç·šã€‚

**æ¶æ§‹æ±ºç­–**:
- âœ… å¯¦ä½œé›™é›†åˆè¨­è¨ˆï¼ˆè³‡æ–™åˆ†é›¢ï¼‰
  - `registrations` é›†åˆï¼šå„²å­˜å ±åè¨‚å–®è³‡æ–™ï¼ˆå®‰å…¨è³‡æ–™ï¼‰
  - `temp_payment_secrets` é›†åˆï¼šå„²å­˜ä¿¡ç”¨å¡è³‡è¨Šï¼ˆæ©Ÿå¯†è³‡æ–™ï¼‰
  - å…©é›†åˆé€é `paymentSecretId` å’Œ `registrationId` äº’ç›¸é—œè¯
- âœ… å‰ç«¯ä¿¡ç”¨å¡æ¬„ä½èˆ‡é©—è­‰
  - æŒå¡äººå§“åã€16 ç¢¼å¡è™Ÿã€æœ‰æ•ˆæœŸé™ï¼ˆMM/YYï¼‰ã€CVV
  - è‡ªå‹•æ ¼å¼åŒ–ï¼šå¡è™Ÿæ¯ 4 ç¢¼åŠ ç©ºæ ¼ã€æœ‰æ•ˆæœŸé™è‡ªå‹•åŠ æ–œç·š
  - å®Œæ•´é©—è­‰ï¼šå¡è™Ÿé•·åº¦ã€CVV é•·åº¦ã€éæœŸæª¢æŸ¥
- âœ… å¾Œç«¯ API (submitRegistration)
  - ä½¿ç”¨ Callable Function è‡ªå‹•é©—è­‰ç™»å…¥
  - ä¸‰å±¤é©—è­‰ï¼šç™»å…¥æª¢æŸ¥ã€è³‡æ–™å®Œæ•´æ€§ã€ä½¿ç”¨è€… ID ä¸€è‡´æ€§
  - ä½¿ç”¨ batch åŒæ™‚å¯«å…¥å…©é›†åˆç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
- âœ… å®‰å…¨æªæ–½
  - Firestore Security Rules å®Œå…¨é–å®šï¼ˆæ‰€æœ‰ç›´æ¥å­˜å–ç¦æ­¢ï¼‰
  - åªæœ‰ Cloud Functions å¯å­˜å–è³‡æ–™
  - HTTPS å‚³è¼¸ï¼ˆVercel è‡ªå‹•ï¼‰

**å·²çŸ¥é¢¨éšª**:
- âš ï¸ å„²å­˜å®Œæ•´ä¿¡ç”¨å¡è³‡æ–™ï¼ˆåŒ…æ‹¬ CVVï¼‰é•å PCI-DSS è¦ç¯„
- âš ï¸ ä½¿ç”¨è€…å·²æ˜ç¢ºç¢ºèªé¢¨éšªä¸¦æ¥å—è²¬ä»»
- âš ï¸ æ­¤ç‚ºè¤‡è£½èˆŠç³»çµ±æµç¨‹çš„éæ¸¡æ–¹æ¡ˆ

**å¾ŒçºŒè¨ˆåŠƒ**:
- ğŸ¯ å¾… LINE Pay ç”³è«‹é€šéå¾Œï¼Œå°‡å‡ç´šç‚ºåˆè¦çš„è‡ªå‹•åŒ–é‡‘æµ
- ğŸ¯ å±†æ™‚å°‡ç§»é™¤ä¿¡ç”¨å¡æ”¶é›†åŠŸèƒ½ï¼Œæ”¹ç”¨å®‰å…¨çš„é‡å®šå‘æ”¯ä»˜

**ç›¸é—œæª”æ¡ˆ**:
- å‰ç«¯ï¼špublic/service/lightup.htmlã€public/service/js/lightup.js
- å¾Œç«¯ï¼šfunctions/src/service/index.js
- è¦å‰‡ï¼šfirestore.rules

### 2025-11-03 æ–‡ä»¶æ•´ç† + ç·šä¸Šé»ç‡ˆ UI é‡æ–°è¨­è¨ˆ
- âœ… æ•´ç†æ ¹ç›®éŒ„æ–‡ä»¶çµæ§‹
  - å»ºç«‹ docs/éƒ¨ç½²æŒ‡å—/ - æ”¶ç´éƒ¨ç½²ç›¸é—œæ–‡ä»¶
  - å»ºç«‹ docs/è¨­å®šæŒ‡å—/ - æ”¶ç´ LINE/LIFF è¨­å®šæ–‡ä»¶
  - å»ºç«‹ docs/é–‹ç™¼æ–‡ä»¶/ - æ”¶ç´æŠ€è¡“é–‹ç™¼æ–‡ä»¶
  - å»ºç«‹ docs/README.md - æ–‡ä»¶ç´¢å¼•ç¸½è¦½
  - æ ¹ç›®éŒ„ä¿æŒä¹¾æ·¨ï¼šåƒ…ä¿ç•™ README.mdã€replit.mdã€LICENSE
- âœ… é‡æ–°è¨­è¨ˆç·šä¸Šé»ç‡ˆé é¢ (public/service/lightup.html)
  - æ¡ç”¨ç¶²ç«™çµ±ä¸€é‡‘é»ƒè‰²ä¸»é¡Œ
  - Header å°èˆªæ¬„ï¼ˆèˆ‡å…¶ä»–é é¢ä¸€è‡´ï¼‰
  - å¡ç‰‡å¼è¨­è¨ˆä½ˆå±€
  - æ”¹é€²çš„è¡¨å–®æ¨£å¼ï¼ˆå¤§è¼¸å…¥æ¡†ã€é‡‘è‰²ç„¦é»æ•ˆæœï¼‰
  - ç¾åŒ–çš„å–®é¸æŒ‰éˆ•ï¼ˆå¡ç‰‡æ¨£å¼ï¼‰
  - æµ®å‹•ç¸½çµæ¬„ä½ï¼ˆé‡‘é»ƒè‰²æ¼¸å±¤èƒŒæ™¯ï¼‰
  - å®Œæ•´éŸ¿æ‡‰å¼è¨­è¨ˆï¼ˆæ‰‹æ©Ÿç‰ˆå‹å–„ï¼‰
  - çµ±ä¸€çš„ CSS è®Šæ•¸ä½¿ç”¨ï¼ˆ--primary-gold, --primary-gold-darkï¼‰

### 2025-11-01 LIFF æ•´åˆï¼ˆLINE Front-end Frameworkï¼‰
- âœ… å»ºç«‹ LIFF å°ˆç”¨é é¢
  - /liff/checkin.html - å¥‰é¦™ç°½åˆ° LIFF App
  - /liff/service.html - ç¥å‹™æœå‹™ LIFF App
  - /liff/schedule.html - æ’ç­ç³»çµ± LIFF App
- âœ… å»ºç«‹ LIFF åˆå§‹åŒ–æ¨¡çµ„ (liff-init.js)
  - LIFF SDK æ•´åˆ
  - è‡ªå‹• LINE ç”¨æˆ¶èªè­‰
  - Firebase Authentication æ•´åˆ
  - æ”¯æ´ç™¼é€è¨Šæ¯åˆ°èŠå¤©å®¤
- âœ… å»ºç«‹ LINE Messaging API Webhook
  - functions/src/messaging/index.js
  - lineWebhook Function å·²éƒ¨ç½² (asia-east2)
  - Webhook URL: https://asia-east2-platform-bc783.cloudfunctions.net/lineWebhook
  - æ”¯æ´é—œéµå­—å›è¦† LIFF URL
  - é—œéµå­—ï¼šå¥‰é¦™ç°½åˆ°ã€ç¥å‹™æœå‹™ã€æ’ç­ç³»çµ±ã€å¹«åŠ©
- âœ… é…ç½®å®Œæˆ
  - LIFF ID: 2008269293-Nl2pZBpVï¼ˆå·²æ›´æ–°åˆ°ä»£ç¢¼ï¼‰
  - Messaging API Channel ID: 2008221557
  - Firebase Secrets å·²è¨­å®šï¼ˆLINE_MESSAGING_CHANNEL_SECRET, LINE_MESSAGING_ACCESS_TOKENï¼‰
- âœ… å®Œæ•´è¨­å®šæ–‡ä»¶
  - LIFF_SETUP_GUIDE.md - è©³ç´°è¨­å®šæ­¥é©Ÿ
  - LINE_é…ç½®æ¸…å–®.md - ç°¡æ˜“é…ç½®æ¸…å–®
  - åŒ…å«æ¸¬è©¦å’Œç–‘é›£æ’è§£æŒ‡å—

### 2025-11-01 å®Œæ•´å¹³å°æ¶æ§‹é‡æ§‹ï¼ˆç¬¬ä¸€ã€äºŒéšæ®µæ¨£æœ¬ï¼‰
- âœ… é‡æ§‹çµ±ä¸€ LINE Login å…¥å£é é¢ (/index.html)
  - ç™»å…¥å¾Œé¡¯ç¤ºæ¨¡çµ„é¸å–®ï¼ˆæ ¹æ“šè§’è‰²æ§åˆ¶å¯è¦‹æ€§ï¼‰
  - é¡¯ç¤ºä½¿ç”¨è€…è³‡è¨Šå’Œé ­åƒ
  - æ”¯æ´å››å€‹æ¨¡çµ„ï¼šå¥‰é¦™ç°½åˆ°ã€ç¥å‹™æœå‹™ã€æ’ç­ç³»çµ±ã€ç³»çµ±ç®¡ç†
- âœ… å»ºç«‹å¾Œå°ç®¡ç†ç¸½è¦½ (/manage/index.html)
  - æ ¹æ“šç®¡ç†å“¡è§’è‰²é¡¯ç¤ºå¯ç®¡ç†çš„æ¨¡çµ„
  - æä¾›å¿«é€Ÿå°èˆªè‡³å„æ¨¡çµ„ç®¡ç†é é¢
- âœ… å»ºç«‹å…±ç”¨èªè­‰æ¨¡çµ„ (auth-guard.js)
  - æä¾› checkAuth å‡½æ•¸é€²è¡Œçµ±ä¸€èªè­‰æª¢æŸ¥
  - æ”¯æ´è§’è‰²æ¬Šé™é©—è­‰
  - å¯è¤‡è£½è‡³å…¶ä»–æ¨¡çµ„ä½¿ç”¨
- âœ… é‡æ§‹å¥‰é¦™ç°½åˆ°æ¨¡çµ„
  - å‰ç«¯ (/checkin/index.html) æ•´åˆ auth-guard
  - å¾Œå°å…¥å£ (/checkin/manage/index.html) ä½¿ç”¨çµ±ä¸€èªè­‰
  - å¾Œå°åŒ…å«ï¼šå„€è¡¨æ¿ã€å·¡é‚é»ç®¡ç†ã€ä½¿ç”¨è€…ç®¡ç†
- âœ… å»ºç«‹æ¨¡çµ„æ¨£æ¿
  - Service æ¨¡çµ„å‰ç«¯ (/service/index.html)
  - Schedule æ¨¡çµ„å‰ç«¯ (/schedule/index.html)
  - ç‚ºç¬¬ä¸‰ã€å››éšæ®µé ç•™æ¨™æº–æ¶æ§‹
- âœ… å„ªåŒ–å…±ç”¨æ¨£å¼ (common.css)
  - æ–°å¢ç®¡ç†é é¢æ¨£å¼
  - æ–°å¢åŠŸèƒ½å¡ç‰‡æ¨£å¼
  - æ”¯æ´éŸ¿æ‡‰å¼è¨­è¨ˆ

### 2025-10-31 LINE Login Web API æ•´åˆï¼ˆæ–¹æ¡ˆ Bï¼‰
- âœ… å¯¦ä½œå®‰å…¨çš„ LINE Login Web API æ•´åˆ
  - ä½¿ç”¨ crypto.randomUUID() ç”Ÿæˆ CSRF-resistant state
  - åœ¨ callback é©—è­‰ state åƒæ•¸é˜²æ­¢ CSRF æ”»æ“Š
  - State ä½¿ç”¨å¾Œç«‹å³æ¸…é™¤é˜²æ­¢é‡è¤‡ä½¿ç”¨
- âœ… æ›´æ–° generateCustomToken Function
  - æ”¯æ´ LINE æˆæ¬Šç¢¼äº¤æ›
  - è‡ªå‹•å–å¾— LINE ä½¿ç”¨è€…è³‡æ–™
  - ç”¢ç”Ÿ Firebase Custom Token
  - è‡ªå‹•å»ºç«‹/æ›´æ–° Firestore ä½¿ç”¨è€…è³‡æ–™ï¼ˆroles é™£åˆ—ï¼‰
- âœ… æ–°å¢ callback.html è™•ç† LINE æˆæ¬Šå›èª¿
- âœ… æ›´æ–° auth.js ä½¿ç”¨ LINE Login Web API
- âœ… ç§»é™¤ Firebase OAuthProvider ä¾è³´
- âœ… æ•´åˆ LINE Secrets ç®¡ç†ï¼ˆLINE_CHANNEL_ID, LINE_CHANNEL_SECRETï¼‰

### 2025-10-31 éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
- âœ… å‰ç«¯æ¨é€åˆ° GitHub (guimashan/platfrom)
- âœ… Vercel è‡ªå‹•éƒ¨ç½² (https://guimashan.vercel.app)
- âœ… Platform Functions éƒ¨ç½²åˆ° platform-bc783
  - generateCustomToken (LINE Login Web API æ•´åˆ)
  - updateUserRole (è§’è‰²ç®¡ç†)
- âœ… Check-in Functions éƒ¨ç½²åˆ° checkin-76c77
  - verifyCheckinDistance (GPS ç°½åˆ°é©—è­‰)
- âš ï¸ Check-in å°ˆæ¡ˆé·ç§»: checkin-29f7f â†’ checkin-76c77
- âœ… Firebase å°ˆæ¡ˆå‡ç´šåˆ° Blaze æ–¹æ¡ˆ
- âœ… åˆå§‹åŒ–å°ˆæ¡ˆ,å®Œæˆ Platform å’Œ Check-in æ¨¡çµ„åŸºç¤åŠŸèƒ½

## æ³¨æ„äº‹é …
- åš´ç¦å°‡ API Key ç¡¬ç·¨ç¢¼åœ¨ç¨‹å¼ç¢¼ä¸­
- ä½¿ç”¨ Replit Secrets ç®¡ç†æ‰€æœ‰æ•æ„Ÿè³‡è¨Š
- Check-in ç°½åˆ°è³‡æ–™å•Ÿç”¨ TTL,ä¿ç•™ 6 å€‹æœˆ
- GPS å®¹è¨±èª¤å·®é è¨­ 30 å…¬å°º,å¯ç”±ç®¡ç†å“¡è‡ªè¨‚
