---
Document ID: DOC-SAD-02
Version: 1.0-internal
Last Updated: 2025-10-30
Maintainer: guimashan-dev
Visibility: internal-only
---

# é¾œé¦¬å±± goLine å¹³å°
## ç³»çµ±æ¶æ§‹è¨­è¨ˆæ–‡ä»¶ (SAD / HLD)

æœ¬æ–‡ä»¶èªªæ˜ã€Œé¾œé¦¬å±± goLine å¹³å°ã€çš„æ•´é«”æŠ€è¡“æ¶æ§‹ã€æ¨¡çµ„åˆ‡åˆ†ã€å‰ç«¯è·¯å¾‘è¦åŠƒèˆ‡ Firebase å°ˆæ¡ˆå°æ‡‰ï¼Œä¾›å…§éƒ¨é–‹ç™¼èˆ‡ç¶­é‹äººå“¡åƒè€ƒã€‚

---

## 1. æ¶æ§‹æ¦‚è¿°

ç³»çµ±æ¡ **å‰å¾Œç«¯åˆ†é›¢**ï¼Œå‰ç«¯ä»¥ HTML5 / JavaScript (ES6+) å¯¦ä½œä¸¦éƒ¨ç½²æ–¼ **Vercel**ï¼ˆFirebase Hosting ä½œç‚ºå‚™æ´ï¼‰ï¼Œå¾Œç«¯ä»¥ **Google Firebase** ç‚ºä¸»é«”ï¼Œæ•´åˆ LINE Login (OAuth 2.0)ã€‚

æ•´é«”æµç¨‹å¦‚ä¸‹ï¼š

1. ä½¿ç”¨è€…æ–¼ç€è¦½å™¨é–‹å•Ÿå¹³å°é¦–é ã€‚
2. é»é¸ã€ŒLINE ç™»å…¥ã€ï¼Œå°å‘ LINE OAuthã€‚
3. å®Œæˆæˆæ¬Šå¾Œå›åˆ°å¹³å°å±¤ï¼ˆplatform-bc783ï¼‰ï¼Œç”± Cloud Function ç”¢ç”Ÿ Firebase Custom Tokenã€‚
4. å‰ç«¯ä»¥è©² Token ç™»å…¥ Firebase Authã€‚
5. ä¾ç…§è§’è‰²å°å‘å„æ¨¡çµ„ï¼ˆcheckin / service / scheduleï¼‰å°æ‡‰çš„å‰ç«¯è·¯å¾‘ã€‚

---

## 2. ç³»çµ±æ¨¡çµ„èˆ‡ Firebase å°ˆæ¡ˆ

| æ¨¡çµ„åç¨± | Firebase å°ˆæ¡ˆ ID | ä¸»è¦ç”¨é€” |
|----------|------------------|----------|
| **å¹³å°å±¤ (Platform)** | **platform-bc783** | ç™»å…¥ã€è§’è‰²ç®¡ç†ã€å…¬å‘Šã€å°æµã€å…±ç”¨å¾Œå° |
| **å¥‰é¦™ç°½åˆ° (Check-in)** | **checkin-29f7f** | GPS é©—è­‰ç°½åˆ°ã€å·¡é‚é»ç®¡ç†ã€ç°½åˆ°ç´€éŒ„å­˜å– |
| **ç¥æœæœå‹™ (Service)** | **service-b9d4a** | é»ç‡ˆã€æ³•æœƒå ±åã€é¦™æ²¹éŒ¢ç´€éŒ„ã€ç®¡ç†å¯©æ ¸ |
| **æ’ç­ç³»çµ± (Schedule)** | **schedule-48ff9** | å¿—å·¥æ’ç­ã€å‡ºå‹¤è¨˜éŒ„ã€å ±è¡¨åŒ¯å‡º |

> ğŸ”´<span style="color:red">è‹¥æ—¥å¾Œæ–°å¢ã€Œçµ±è¨ˆ / åˆ†æã€æ¨¡çµ„ï¼Œå¯å†å¢è¨­ç¨ç«‹ Firebase å°ˆæ¡ˆï¼Œé¿å…æŸ¥è©¢èˆ‡å¯«å…¥äº’ç›¸å½±éŸ¿ã€‚</span>

---

## 3. Firebase å››å¤§æœå‹™èªªæ˜

| Firebase å…ƒä»¶         | ç”¨é€”     | æœ¬å°ˆæ¡ˆä½¿ç”¨æ–¹å¼                                          |
| ------------------- | ------ | ------------------------------------------------ |
| **Auth**            | èº«åˆ†é©—è­‰   | æ•´åˆ LINE Loginï¼Œç™»å…¥å¾Œå»ºç«‹ / æ›´æ–° Firestore `users/{uid}` |
| **Firestore**       | æ–‡ä»¶å‹è³‡æ–™åº« | å„²å­˜ usersã€checkinsã€patrolsã€servicesã€schedules     |
| **Cloud Functions** | é›²ç«¯åŸ·è¡Œé‚è¼¯ | é©—è­‰ GPS è·é›¢ã€å¯©æ ¸ç¥æœç”³è«‹ã€æ›´æ–°ä½¿ç”¨è€…è§’è‰²                         |
| **Hosting**         | éœæ…‹ç¶²ç«™è¨—ç®¡ | å¯åšç‚º Vercel å‚™æ´ï¼Œæˆ–æä¾›å¾Œå°å…§éƒ¨ç¶²å€                          |


> æ‰€æœ‰ã€Œåªèƒ½ç”±ç®¡ç†å“¡æ“ä½œã€çš„è¡Œç‚ºï¼Œä¸€å¾‹åœ¨ Cloud Functions ç«¯å®Œæˆï¼Œå‰ç«¯åªç™¼å‡ºè«‹æ±‚ã€ä¸ç›´æ¥æ”¹è³‡æ–™ã€‚

---

## 4. è³‡æ–™æµèªªæ˜

```text
[User Browser]
    â”‚ 1. LINE OAuth 2.0
    â–¼
[Platform (platform-bc783)]
    â”‚ 2. ç”¢ç”Ÿ Firebase Custom Token
    â–¼
[Firebase Auth]
    â”‚ 3. ä¾è§’è‰²åˆ†æµ
    â”œâ”€â”€> Check-in å‰ç«¯ (/checkin/)
    â”œâ”€â”€> Service å‰ç«¯ (/service/)
    â””â”€â”€> Schedule å‰ç«¯ (/schedule/)
           â”‚
           â–¼
        [Firestore + Cloud Functions]
```
èªªæ˜ï¼š
1. **ç™»å…¥éšæ®µ** ä¸€å¾‹èµ° platform å°ˆæ¡ˆï¼Œç¢ºä¿ç™»å…¥èˆ‡è§’è‰²åˆ¤æ–·åœ¨åŒä¸€å€‹ç’°å¢ƒã€‚
2. **æ¥­å‹™è³‡æ–™** åˆ†åˆ¥è½åœ¨å„è‡ªçš„å°ˆæ¡ˆï¼ˆcheckin / service / scheduleï¼‰ï¼Œé™ä½è³‡æ–™äº’ç›¸å¹²æ“¾çš„é¢¨éšªã€‚
3. **ç®¡ç†ç«¯ï¼ˆ/admin/ï¼‰** ç¸½æ˜¯å›åˆ° platformï¼Œå› ç‚ºè¦æ©«è·¨ä¸‰å€‹æ¨¡çµ„ã€‚

## 5. å‰ç«¯è·¯å¾‘èˆ‡ Firebase å°ˆæ¡ˆå°æ‡‰
é€™ä¸€æ®µæ˜¯å‰ç«¯æœ€å¸¸å•ã€ä¹Ÿæ˜¯å‰›å‰›ä½ èªªã€Œæ€éº¼å°‘äº†ä¸€å€‹ã€çš„åœ°æ–¹ï¼Œé€™è£¡ä¸€æ¬¡èªªæ¸…æ¥š ğŸ‘‡

| **å‰ç«¯è·¯å¾‘**   | **æ‰€å±¬æ¨¡çµ„**       | **Firebase å°ˆæ¡ˆ**    | **éƒ¨ç½²å»ºè­°**                     | **èªªæ˜**                 |
| ---------- | -------------- | ------------------ | ---------------------------- | ---------------------- |
| /          | å¹³å°å±¤ (Platform) | **platform-bc783** | Vercel ä¸»ç«™ / Firebase Hosting | ç™»å…¥é¦–é ã€å…¬å‘Šã€å°æµ             |
| /checkin/  | å¥‰é¦™ç°½åˆ°           | **checkin-29f7f**  | Vercel å­è·¯å¾‘æˆ–ç¨ç«‹å°ˆæ¡ˆ              | GPS ç°½åˆ°ã€å·¡é‚é»ç®¡ç†           |
| /service/  | ç¥æœæœå‹™           | **service-b9d4a**  | Vercel å­è·¯å¾‘æˆ–ç¨ç«‹å°ˆæ¡ˆ              | é»ç‡ˆã€æ³•æœƒå ±åã€é¦™æ²¹éŒ¢            |
| /schedule/ | æ’ç­ç³»çµ±           | **schedule-48ff9** | Vercel å­è·¯å¾‘æˆ–ç¨ç«‹å°ˆæ¡ˆ              | å¿—å·¥ç­è¡¨ã€å‡ºå‹¤è¨˜éŒ„              |
| /admin/    | ç®¡ç†å¾Œå°           | **platform-bc783** | åƒ…é™å…§éƒ¨                         | superadmin / admin æ§åˆ¶å° |
å‚™è¨»ï¼š
/admin/ ä¸€å®šè¦ç¶åœ¨ platform-bc783ï¼Œå› ç‚ºå®ƒè¦èƒ½çœ‹ / æ”¹ã€Œä¸‰å€‹æ¨¡çµ„ã€çš„è³‡æ–™ã€‚

å„æ¨¡çµ„å‰ç«¯å¯ä»¥æ˜¯åŒä¸€å€‹ repo ä¸‹çš„ä¸åŒå­è³‡æ–™å¤¾ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸‰å€‹ç¨ç«‹å‰ç«¯å°ˆæ¡ˆï¼Œè¦–ä½ å€‘ R ç¤¾çš„é–‹ç™¼ç¿’æ…£è€Œå®šã€‚

ğŸ”´<span style="color:red">è‹¥è¦èµ°å–®é æ‡‰ç”¨ (SPA) è·¯å¾‘é‡å¯«ï¼Œè«‹åœ¨ Vercel æˆ– Firebase Hosting åŠ ä¸Š rewrites è¦å‰‡ã€‚</span>

## 6. å‰ç«¯éƒ¨ç½²å»ºè­°ï¼ˆVercel / Firebase Hostingï¼‰
6.1 Vercel å¤šè·¯å¾‘éƒ¨ç½²ç¯„ä¾‹

```json
{
  "rewrites": [
    { "source": "/checkin/:path*", "destination": "/checkin/index.html" },
    { "source": "/service/:path*", "destination": "/service/index.html" },
    { "source": "/schedule/:path*", "destination": "/schedule/index.html" },
    { "source": "/admin/:path*", "destination": "/admin/index.html" }
  ]
}
```
6.2 Firebase Hosting å‚™æ´éƒ¨ç½²
```bash

# å¥‰é¦™ç°½åˆ°å‰ç«¯
firebase deploy --project checkin-29f7f --only hosting

# ç¥æœæœå‹™å‰ç«¯
firebase deploy --project service-b9d4a --only hosting
```
ğŸ”´<span style="color:red"></span>è«‹æ±ºå®šæœ€çµ‚è¦ä»¥ Vercel ç‚ºä¸»ï¼Œé‚„æ˜¯è¦è®“ Firebase Hosting ç•¶ç½é›£å‚™æ´ï¼ˆDRï¼‰ï¼Œå…©è€…åŒæ™‚é–‹è¦æ³¨æ„ç¶²åŸŸè¨­å®šã€‚

## **7. å®‰å…¨èˆ‡æ¬Šé™è¨­è¨ˆ**

1. **èº«åˆ†é©—è­‰**
    - é€é LINE â†’ Firebase Authï¼Œæ‰€æœ‰è«‹æ±‚å‡é ˆå¸¶ Firebase ID Tokenã€‚
2. **æˆæ¬Šæ§ç®¡**
    - Cloud Functions é©—è­‰è§’è‰²æ¬Šé™ï¼Œæ‹’çµ•éç®¡ç†è€…æ“ä½œæ•æ„Ÿè³‡æ–™ã€‚
3. **è³‡æ–™åº«è¦å‰‡**
    - ç¦æ­¢ client ç«¯ç›´æ¥ä¿®æ”¹ users.role æˆ– services.statusã€‚
4. **æœ€å°æ¬Šé™åŸå‰‡**
    - å„ Firebase å°ˆæ¡ˆåƒ…é–‹æ”¾å°æ‡‰äººå“¡ï¼›Platform å°ˆæ¡ˆç”± superadmin å…¨æ¬Šç®¡æ§ã€‚
5. **æ†‘è­‰ç®¡ç†**
    - æ‰€æœ‰é‡‘é‘°å­˜æ”¾æ–¼ Secret Manager æˆ– GitHub Secretsï¼Œä¸æ‡‰æäº¤è‡³ä»»ä½• repoã€‚

## 8. CI / CD èˆ‡ç’°å¢ƒ
| **ç’°å¢ƒ**         | **èªªæ˜**                      | **ä¾‹ç¤º**                      |
| -------------- | --------------------------- | --------------------------- |
| **local**      | æœ¬æ©Ÿé–‹ç™¼ç’°å¢ƒï¼Œä½¿ç”¨ Firebase Emulator | firebase emulators:start    |
| **staging**    | æ¸¬è©¦ç’°å¢ƒï¼Œå°æ‡‰æ¸¬è©¦ Firebase å°ˆæ¡ˆ       | ğŸ”´å¡«å…¥ staging ç¶²åŸŸ             |
| **production** | æ­£å¼ç’°å¢ƒï¼Œå°æ‡‰å››å€‹æ­£å¼å°ˆæ¡ˆ               | https://go.guimashan.org.tw |
**éƒ¨ç½²ç­–ç•¥**
- main â†’ production
- develop â†’ staging
- Functions å„æ¨¡çµ„ç¨ç«‹ deployï¼Œé¿å…äº’ç›¸è¦†è“‹ã€‚
- Vercel è‡ªå‹•åµæ¸¬åˆ†æ”¯ä¸¦åˆ†é… preview domainã€‚

## 9. å°šå¾…è£œå¡«é …ç›®
- ğŸ”´æœ€çµ‚ç‰ˆ LINE Login callback URL
- ğŸ”´Vercel å°ˆæ¡ˆ ID èˆ‡åœ˜éšŠåç¨±
- ğŸ”´Cloud Functions éƒ¨ç½²å€åŸŸï¼ˆå»ºè­° asia-east2ï¼‰
- ğŸ”´Firebase Hosting DNS è¨­å®šæ–‡ä»¶
- ğŸ”´æ˜¯å¦å•Ÿç”¨ /admin/ ç™½åå–®é™åˆ¶
