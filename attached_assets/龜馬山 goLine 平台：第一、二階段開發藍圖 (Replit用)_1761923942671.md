

Replit=R ç¤¾

**è‡´ R ç¤¾ (Replit AI)ï¼š**

æœ¬è—åœ–åŒ…å«å…©å¤§éƒ¨åˆ†ï¼Œè«‹åš´æ ¼éµå®ˆï¼š

1. **æœ€çµ‚ç‰ˆè¦æ ¼æ›´æ–°æ—¥èªŒ (V3 æ¶æ§‹)ï¼š** å‘Šè¨´æ‚¨ã€Œ**è¦åšä»€éº¼**ã€ã€‚
    
2. **Replit é–‹ç™¼ç’°å¢ƒè¨­å®šæŒ‡å—ï¼š** å‘Šè¨´æ‚¨ã€Œ**è¦å¦‚ä½•è¨­å®šç’°å¢ƒä¾†åš**ã€ã€‚
    

è«‹ä¾å¾ªæœ¬è—åœ–ï¼Œé–‹å§‹é–‹ç™¼**ç¬¬ä¸€éšæ®µ (Platform)** å’Œ**ç¬¬äºŒéšæ®µ (Check-in)**ã€‚

---

### ç¬¬ä¸€éƒ¨åˆ†ï¼šæœ€çµ‚ç‰ˆè¦æ ¼æ›´æ–°æ—¥èªŒ (V3 æ¶æ§‹)

ä»¥ä¸‹æ˜¯é‡å°å…«ä»½æ–‡ä»¶çš„æ‰€æœ‰è®Šæ›´èˆ‡æ±ºç­–è©³æƒ…ï¼š

#### 1. `01_SRS_PRD_internal.md` (ç³»çµ±éœ€æ±‚æ›¸)

- **LINE ç™»å…¥è³‡è¨Š (Section 9):**
    
    - Channel ID: `2008269293`
        
    - Channel Secret: 025a71c97099343e6e688bb6e393a125
        
- **Firebase å°ˆæ¡ˆè³‡è¨Š (Section 9):**
    
    - `platform-bc783`: (ApiKey:AIzaSyAcQJA7Tx0LnW8M51WM9bChvlAS_J7qcEw/AppId:1:971307854623:web:29b96be8c4f0a457d19e2a)
        
    - `checkin-29f7f`: (ApiKey:AIzaSyAnXFLHm7u9Ji0ualJDl9qGQQ1l4zcRnvg/AppId:1:264033873783:web:d871356277e5d06749fb72)
        
    - `service-b9d4a`: (ApiKey:AIzaSyAxuPR2U1Gk03fNOOPndC00XPnLeCuH57o/AppId:1:662128429399:web:3a132ce010d046649a1612)
        
    - `schedule-48ff9`: (ApiKey:AIzaSyCnuspwgT20n5104dBtMVPfV54KclZI92s/AppId:1:135135952493:web:24fdd0155b17c881014964)
        
- **è§’è‰²å‘½å (Section 8):** (**V3 æ¶æ§‹è®Šæ›´**)
    
    - åŸæœ‰çš„ `admin` è§’è‰²è¢«å»¢é™¤ã€‚
        
    - è§’è‰²ç³»çµ±**å‡ç´šç‚ºé™£åˆ— (Array)**ã€‚
        
    - æ–°å¢è§’è‰²ï¼š`admin_checkin`, `admin_service`, `admin_schedule`ã€‚
        

#### 2. `02_SAD_HLD_internal.md` (ç³»çµ±æ¶æ§‹è¨­è¨ˆ)

- **LINE ç™»å…¥ (Section 1 & 9):**
    
    - æœ€çµ‚ç‰ˆ LINE Login callback URL ç¢ºèªç‚ºï¼š`https://go.guimashan.org.tw/__/auth/handler`ã€‚
        
    - ç³»çµ±å°‡åŒæ™‚æ”¯æ´æ­¤ Web ç™»å…¥æµç¨‹ (ç”± Firebase SDK è‡ªå‹•è™•ç†) èˆ‡ LIFF ç™»å…¥æµç¨‹ (ä½¿ç”¨ `generateCustomToken` API)ã€‚
        
- **å‰ç«¯éƒ¨ç½² (Section 1, 6, 9):**
    
    - éƒ¨ç½²ç­–ç•¥ï¼šç¢ºèªä»¥ **Vercel ç‚ºä¸»**ã€‚
        
    - Vercel åœ˜éšŠåç¨±: `guimashan's projects`ã€‚
        
    - Vercel å°ˆæ¡ˆ ID: `prj_FwuUrTa2m4MaMocVnb2wAGB8CPyy`ã€‚
        
    - Staging (æ¸¬è©¦) ç¶²å€ï¼šç¢ºèªä½¿ç”¨ `guimashan.vercel.app`ã€‚
        
- **å¾Œç«¯éƒ¨ç½² (Section 9):**
    
    - Cloud Functions éƒ¨ç½²å€åŸŸï¼šç¢ºèªä½¿ç”¨ `asia-east2`ã€‚
        
- **å®‰å…¨è¨­å®š (Section 9):**
    
    - ç¢ºèª**ä¸å•Ÿç”¨** `/admin/` çš„ IP ç™½åå–®é™åˆ¶ã€‚
        

#### 3. `03_UI_UX_internal.md` (ä»‹é¢èˆ‡ä½¿ç”¨è€…é«”é©—)

- **è§’è‰²èˆ‡å°è¦½ (Section 2):** (**V3 æ¶æ§‹è®Šæ›´**)
    
    - è§’è‰²å®šç¾©æ›´æ–°ç‚º `admin_checkin`, `admin_service`, `admin_schedule`, `superadmin`ã€‚
        
    - å°è¦½è¡Œç‚ºè®Šæ›´ï¼šä½¿ç”¨è€…ç™»å…¥å¾Œï¼Œå‰ç«¯éœ€æª¢æŸ¥å…¶ `roles` (é™£åˆ—)ï¼Œä»¥æ±ºå®šå°å‘å“ªå€‹ç®¡ç†é é¢æˆ–é¡¯ç¤ºå“ªäº› UI å…ƒä»¶ã€‚
        
- **å¥‰é¦™ç°½åˆ° (Section 4.1):**
    
    - GPS å®¹è¨±èª¤å·®ï¼šé è¨­å€¼ç‚º 30 å…¬å°ºã€‚
        
    - `checkin/admin.html` (å·¡é‚é»ç®¡ç†) é é¢ å¿…é ˆå…è¨± `admin_checkin` å’Œ `superadmin` è‡ªè¡Œæ–°å¢/ç·¨è¼¯å·¡é‚é»ï¼Œä¸¦å¯è‡ªå®šç¾©æ¯å€‹å·¡é‚é»çš„ `tolerance` (å®¹è¨±èª¤å·®) æ¬„ä½ã€‚
        
- **ç®¡ç†å¾Œå° (Section 4.4):** (**V3 æ¶æ§‹è®Šæ›´**)
    
    - `admin/dashboard.html` (å„€è¡¨æ¿) å¿…é ˆæ˜¯**å‹•æ…‹å„€è¡¨æ¿**ã€‚
        
    - å„€è¡¨æ¿æ‡‰æ ¹æ“šä½¿ç”¨è€…çš„ `roles` (é™£åˆ—) ä¾†æ±ºå®šé¡¯ç¤ºå“ªäº›æ¨¡çµ„çš„çµ±è¨ˆå¡ç‰‡ï¼ˆä¾‹å¦‚ `roles` åŒ…å« `admin_checkin` æ‰é¡¯ç¤ºç°½åˆ°çµ±è¨ˆï¼‰ã€‚
        
    - `superadmin` å¯çœ‹åˆ°æ‰€æœ‰æ¨¡çµ„çš„çµ±è¨ˆã€‚
        
- **ç¥æœæœå‹™ (Section 4.2 & 9):**
    
    - (å¾…è¾¦) ç¬¬ä¸‰éšæ®µï¼šæª”æ¡ˆä¸Šå‚³åŠŸèƒ½ (Storage) æš«ç·©é–‹ç™¼ã€‚
        

#### 4. `04_API_SPEC_internal.md` (API èˆ‡ Functions è¦æ ¼)

- **é€šç”¨æˆæ¬Š (Section 2):** (**V3 æ¶æ§‹è®Šæ›´**)
    
    - æ‰€æœ‰ API çš„æˆæ¬Šé©—è­‰é‚è¼¯ï¼Œå¿…é ˆå¾æª¢æŸ¥ `role` (å­—ä¸²) `== "admin"`ï¼Œ**å…¨é¢å‡ç´š**ç‚ºæª¢æŸ¥ `roles` (é™£åˆ—) `includes("...")`ã€‚
        
    - ç¯„ä¾‹ï¼š`approveServiceRequest` (Section 4.2) çš„æˆæ¬Šæ¢ä»¶æ”¹ç‚º `roles.includes("admin_service") || roles.includes("superadmin")`ã€‚
        
- **ç°½åˆ°æ¨¡çµ„ (Section 3.1):**
    
    - `verifyCheckinDistance`: API éœ€è®€å– `patrols/{patrolId}` ä¸­çš„ `tolerance` æ¬„ä½ ä½œç‚ºå®¹è¨±èª¤å·®ï¼ˆè‹¥è©²æ¬„ä½ä¸å­˜åœ¨ï¼Œå‰‡é è¨­ 30 å…¬å°ºï¼‰ã€‚
        
- **å¹³å°å±¤ (Section 6.2):** (**V3 æ¶æ§‹è®Šæ›´**)
    
    - `updateUserRole`: æ­¤ API é‚è¼¯éœ€é‡æ§‹ï¼Œä½¿å…¶èƒ½å¤ ç·¨è¼¯ `targetUserId` çš„ `roles` (é™£åˆ—)ï¼Œä¾‹å¦‚æ–°å¢æˆ–ç§»é™¤é™£åˆ—ä¸­çš„ç‰¹å®šè§’è‰²å­—ä¸²ã€‚
        
- **å°šå¾…è£œå¡« (Section 9):**
    
    - éƒ¨ç½² Regionï¼šç¢ºèª `asia-east2`ã€‚
        
    - Rate Limitï¼šç¢ºèª**ä¸ç”¨**ã€‚
        
    - Logging ä¿ç•™ï¼šç¢ºèª **30 å¤©**ã€‚
        

#### 5. `05_DDD_DB_DESIGN_internal.md` (è³‡æ–™æ¨¡å‹èˆ‡é ˜åŸŸè¨­è¨ˆ)

- **users é›†åˆ (Section 3.1):** (**V3 æ¶æ§‹è®Šæ›´ - æ ¸å¿ƒ**)
    
    - `role` (String) æ¬„ä½**æ­£å¼å»¢é™¤**ã€‚
        
    - **è®Šæ›´ç‚º `roles` (Array) æ¬„ä½**ã€‚
        
    - ç¯„ä¾‹ï¼š
        
        - ä¸€èˆ¬ä½¿ç”¨è€…: `roles: ["user"]`
            
        - ç¥æœä½¿ç”¨è€…: `roles: ["user", "poweruser"]`
            
        - å–®ä¸€ç®¡ç†å“¡: `roles: ["user", "poweruser", "admin_service"]`
            
        - å¤šé‡ç®¡ç†å“¡: `roles: ["user", "poweruser", "admin_checkin", "admin_schedule"]`
            
        - è¶…ç´šç®¡ç†å“¡: `roles: ["user", "poweruser", "admin_checkin", "admin_service", "admin_schedule", "superadmin"]`
            
    - `email` æ¬„ä½ï¼šç¢ºèªå•Ÿç”¨ï¼Œç”¨æ–¼è¨˜éŒ„å¾ LINE å–å¾—çš„ Emailï¼ˆéç”¨æ–¼ Email/å¯†ç¢¼ ç™»å…¥ï¼‰ã€‚
        
- **checkins é›†åˆ (Section 3.2 & 8):**
    
    - **å•Ÿç”¨ TTL (Time-to-Live) æ”¿ç­–**ã€‚
        
    - è³‡æ–™ä¿ç•™æ™‚é–“ï¼š**åŠå¹´ (6 å€‹æœˆ)**ã€‚
        
- **patrols é›†åˆ (Section 3.3):**
    
    - `tolerance` æ¬„ä½ï¼šç¢ºèªä½¿ç”¨æ­¤æ¬„ä½ï¼Œé è¨­ 30 å…¬å°ºã€‚
        
- **globalConfig é›†åˆ (Section 3.6 & 8):**
    
    - ç¢ºèª**åƒ…éœ€ä¸­æ–‡**ï¼Œä¸å°å…¥å¤šèªç³»æ¬„ä½ã€‚
        
- **Storage (Section 8):**
    
    - (å¾…è¾¦) ç¬¬ä¸‰éšæ®µï¼šStorage çµæ§‹ (æ”¶æ“šä¸Šå‚³) æš«ç·©è¨­è¨ˆã€‚
        

#### 6. `06_TEST_PLAN_internal.md` (æ¸¬è©¦è¨ˆç•«)

- **æ¸¬è©¦ç’°å¢ƒ (Section 4):**
    
    - Staging å°ˆæ¡ˆèˆ‡åŸŸåï¼šç¢ºèªç‚º **`guimashan.vercel.app`**ã€‚
        
- **éŒ¯èª¤è¿½è¹¤ (Section 9):**
    
    - ç¢ºèªä½¿ç”¨ **Google Sheets**ã€‚
        
- **å°šå¾…è£œå¡« (Section 10):**
    
    - è‡ªå‹•åŒ–æ¸¬è©¦ï¼šç¢ºèª**åˆæœŸ (P1/P2) ä¸å°å…¥**ã€‚
        
    - æœ€çµ‚é©—æ”¶è² è²¬äººï¼š**æ‚¨æœ¬äºº (å°ˆæ¡ˆæ¥­ä¸»)**ã€‚
        

#### 7. `07_PMP_Project_Plan_internal.md` (å°ˆæ¡ˆè¨ˆç•«æ›¸)

- **å°ˆæ¡ˆçµ„ç¹” (Section 4 & 10):**
    
    - å°ˆæ¡ˆç¶“ç†ï¼šGemini (AI åœ˜éšŠ)
        
    - ç³»çµ±æ¶æ§‹å¸«ï¼šGemini (AI åœ˜éšŠ)
        
    - æ¸¬è©¦èˆ‡é©—æ”¶ï¼šæ‚¨æœ¬äºº (å°ˆæ¡ˆæ¥­ä¸»)
        
    - ç¶­é‹èˆ‡æ–‡ä»¶ï¼šGemini (AI åœ˜éšŠ)
        
    - å‰ç«¯/å¾Œç«¯é–‹ç™¼ï¼šR ç¤¾ (Replit AI)
        

#### 8. `README_internal_index.md` (ç´¢å¼•æ–‡ä»¶)

- **æ–‡ä»¶ç¶­è­· (Section 5 & 6):**
    
    - è§’è‰²åˆ†é…å·²ä¾ PMP æ–‡ä»¶ æ›´æ–°ã€‚
        

---

### ç¬¬äºŒéƒ¨åˆ†ï¼šReplit é–‹ç™¼ç’°å¢ƒè¨­å®šæŒ‡å— (R ç¤¾ç”¨)

ç‚ºäº†æ­£ç¢ºé–‹ç™¼ã€Œé¾œé¦¬å±± goLine å¹³å°ã€ï¼ŒReplit å°ˆæ¡ˆå¿…é ˆç¬¦åˆä»¥ä¸‹ç’°å¢ƒè¨­å®šï¼š

#### 1. æ ¸å¿ƒç’°å¢ƒ (Core Environment)

- **Node.js ç‰ˆæœ¬ï¼š** å¿…é ˆä½¿ç”¨ **20.x** ç‰ˆæœ¬ã€‚é€™ç¬¦åˆ Cloud Functions Node.js 20 çš„åŸ·è¡Œç’°å¢ƒã€‚
    
- **Firebase CLIï¼š** å¿…é ˆå®‰è£ä¸¦ä½¿ç”¨æœ€æ–°ç‰ˆçš„ `firebase-tools` (Firebase CLI)ã€‚
    

#### 2. å°ˆæ¡ˆçµæ§‹ (Monorepo Setup)

- **å–®ä¸€å€‰åº« (Monorepo)ï¼š** æ•´å€‹å°ˆæ¡ˆæ‡‰åœ¨ä¸€å€‹ Replit å€‰åº«ä¸­ï¼ˆGitHub: `guimashan/platfrom`ï¼‰ï¼Œä½†ç¨‹å¼ç¢¼éœ€æŒ‰æ¨¡çµ„**åš´æ ¼åˆ†é›¢**ã€‚
    
- **å‰ç«¯ç›®éŒ„ï¼š** ä¾ç…§ `03_UI_UX_internal.md` çš„è¦åŠƒï¼Œå‰ç«¯æ‡‰æœ‰ `checkin/`, `service/`, `schedule/`, `admin/` ç­‰å­ç›®éŒ„ï¼Œä»¥åŠæ ¹ç›®éŒ„çš„ `login.html`ã€‚
    
- **å¾Œç«¯ç›®éŒ„ï¼š** å»ºè­°å»ºç«‹ä¸€å€‹ `functions/` ç›®éŒ„ï¼Œç”¨ä¾†å­˜æ”¾æ‰€æœ‰ Cloud Functions çš„åŸå§‹ç¢¼ï¼Œä¸¦åœ¨å…§éƒ¨å†åˆ†å­ç›®éŒ„ (ä¾‹å¦‚ `functions/src/platform`, `functions/src/checkin` ç­‰)ã€‚
    

#### 3. ğŸ”´ ç‰¹æ®Šè¨­å®šï¼šç’°å¢ƒè®Šæ•¸ (Replit Secrets)

é€™æ˜¯**æœ€é‡è¦**çš„è¨­å®šã€‚æ ¹æ“š `02_SAD_HLD_internal.md` çš„å®‰å…¨è¦ç¯„ï¼Œ**åš´ç¦**å°‡ä»»ä½• API Key æˆ– Secret ç¡¬ç·¨ç¢¼ (Hardcode) åœ¨ç¨‹å¼ç¢¼ä¸­ã€‚æ‰€æœ‰é‡‘é‘°å¿…é ˆä½¿ç”¨ Replit çš„ **"Secrets"** å·¥å…·ä¾†ç®¡ç†ã€‚

R ç¤¾åœ¨é–‹ç™¼æ™‚ï¼Œç¨‹å¼ç¢¼éœ€è¦è®€å–ä»¥ä¸‹ Secretsï¼š

**A. å‰ç«¯ (Client-Side) æ‰€éœ€çš„ Secretsï¼š**

- å‰ç«¯ JavaScript å¿…é ˆ**åŒæ™‚åˆå§‹åŒ–å››å€‹ Firebase æ‡‰ç”¨å¯¦ä¾‹**ã€‚ç¨‹å¼ç¢¼æ‡‰å¾ Secrets è®€å–é€™å››çµ„é‡‘é‘°ï¼ˆé‡‘é‘°å…§å®¹å·²ç”± PM å­˜æª”ï¼‰ï¼š
    
    - `REPLIT_SECRET_FIREBASE_CONFIG_PLATFORM` (å…§å®¹ç‚º `platform-bc783` çš„ apiKey, appId ç­‰)
        
    - `REPLIT_SECRET_FIREBASE_CONFIG_CHECKIN` (å…§å®¹ç‚º `checkin-29f7f` çš„ apiKey, appId ç­‰)
        
    - `REPLIT_SECRET_FIREBASE_CONFIG_SERVICE` (å…§å®¹ç‚º `service-b9d4a` çš„ apiKey, appId ç­‰)
        
    - `REPLIT_SECRET_FIREBASE_CONFIG_SCHEDULE` (å…§å®¹ç‚º `schedule-48ff9` çš„ apiKey, appId ç­‰)
        

**B. å¾Œç«¯ (Server-Side / Functions) æ‰€éœ€çš„ Secretsï¼š**

- `platform-bc783` å°ˆæ¡ˆä¸­çš„ Cloud Functions (ä¾‹å¦‚ `generateCustomToken`) éœ€è¦ LINE çš„é‡‘é‘°ï¼š
    
    - `REPLIT_SECRET_LINE_CHANNEL_ID_LOGIN` (å€¼: `2008269293`)
        
    - `REPLIT_SECRET_LINE_CHANNEL_SECRET_LOGIN` (å€¼: å·²ç”± PM å­˜æª”)
        
- Cloud Functions éœ€è¦ Firebase Admin SDKã€‚åœ¨ Replit ç’°å¢ƒä¸­ï¼Œå¯èƒ½éœ€è¦è¨­å®š `GOOGLE_APPLICATION_CREDENTIALS` æŒ‡å‘æ‚¨ç‚º**å››å€‹å°ˆæ¡ˆ**åˆ†åˆ¥ä¸‹è¼‰çš„ Service Account JSON é‡‘é‘°ã€‚
    

#### 4. æœ¬åœ°é–‹ç™¼èˆ‡æ¨¡æ“¬ (Local Emulation)

- åœ¨ Replit ä¸­é€²è¡Œæœ¬åœ°é–‹ç™¼æ™‚ï¼Œ**å¿…é ˆ**ä½¿ç”¨ **Firebase Emulator Suite**ã€‚
    
- R ç¤¾éœ€è¦è¨­å®š `firebase.json` æª”æ¡ˆï¼Œä»¥ä¾¿èƒ½é€é `firebase emulators:start` æŒ‡ä»¤ï¼Œåœ¨æœ¬æ©Ÿï¼ˆReplit ä¼ºæœå™¨ä¸Šï¼‰æ¨¡æ“¬ **Auth, Firestore, å’Œ Functions** æœå‹™ï¼Œä»¥åˆ©é–‹ç™¼å’Œæ¸¬è©¦ã€‚