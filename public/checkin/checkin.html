<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥‰é¦™ç°½åˆ° - é¾œé¦¬å±±æ•´åˆæœå‹™å¹³å°</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/common.css">
    <link rel="stylesheet" href="/checkin/styles/checkin.css">
</head>
<body>
    <!-- ç™»å…¥æç¤ºç•«é¢ï¼ˆé è¨­é¡¯ç¤ºï¼‰ -->
    <div id="loginPrompt" style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); flex-direction: column;">
        <div style="text-align: center; color: white; padding: 40px; background: rgba(255,255,255,0.1); border-radius: 16px; backdrop-filter: blur(10px);">
            <div style="font-size: 64px; margin-bottom: 20px;">ğŸ™</div>
            <h2 style="margin: 0 0 10px 0; font-size: 24px;">å¥‰é¦™ç°½åˆ°ç³»çµ±</h2>
            <p style="margin: 0; opacity: 0.9;">è«‹ä½¿ç”¨ LINE å¸³è™Ÿç™»å…¥ä»¥é–‹å§‹ç°½åˆ°</p>
            <div style="margin-top: 30px; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 8px;">
                <p style="margin: 0; font-size: 14px;">é©—è­‰ä¸­...</p>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹ï¼ˆé è¨­éš±è—ï¼‰ -->
    <div id="mainApp" class="container" style="display: none;">
        <header class="header">
            <div class="header-left">
                <h1>ğŸ™ å¥‰é¦™ç°½åˆ°</h1>
                <p id="userName" style="margin: 5px 0 0 0; font-size: 14px; color: #666;"></p>
            </div>
            <div class="header-actions">
                <button class="btn-home" onclick="window.location.href='/'">é¦–é </button>
                <button id="logoutBtn" class="btn-logout">ç™»å‡º</button>
            </div>
        </header>

        <main class="main-content">
            <div id="checkinCard" class="checkin-card">
                <h2>å¥‰é¦™ç°½åˆ°</h2>
                
                <!-- ç°½åˆ°æ¨¡å¼åˆ‡æ› -->
                <div class="mode-tabs">
                    <button id="gpsModeBtn" class="mode-tab active">ğŸ“ GPS ç°½åˆ°</button>
                    <button id="qrModeBtn" class="mode-tab">ğŸ“· QR Code ç°½åˆ°</button>
                </div>

                <!-- GPS ç°½åˆ°æ¨¡å¼ -->
                <div id="gpsMode" class="mode-content">
                    <div id="patrolSelect" class="patrol-select">
                        <label for="patrolDropdown">é¸æ“‡å·¡é‚é»:</label>
                        <select id="patrolDropdown" class="form-select">
                            <option value="">è¼‰å…¥ä¸­...</option>
                        </select>
                    </div>

                    <div id="locationStatus" class="location-status">
                        <p>æº–å‚™é–‹å§‹ç°½åˆ°</p>
                    </div>

                    <button id="checkinBtn" class="btn btn-primary btn-large">
                        é–‹å§‹ GPS ç°½åˆ°
                    </button>
                </div>

                <!-- QR Code ç°½åˆ°æ¨¡å¼ -->
                <div id="qrMode" class="mode-content hidden">
                    <div id="qrReader" style="width: 100%; max-width: 500px; margin: 20px auto;"></div>
                    
                    <div id="qrStatus" class="location-status">
                        <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹æƒæ</p>
                    </div>

                    <button id="startQrBtn" class="btn btn-primary btn-large">
                        ğŸ“· é–‹å§‹æƒæ QR Code
                    </button>
                    <button id="stopQrBtn" class="btn btn-secondary btn-large hidden">
                        â¹ï¸ åœæ­¢æƒæ
                    </button>
                </div>

                <div id="result" class="result-area hidden"></div>
            </div>

            <!-- æŸ¥çœ‹è¨˜éŒ„é€£çµ - å¡ç‰‡å¤–éƒ¨ -->
            <div class="history-link-outside">
                <a href="/checkin/history.html">ğŸ“‹ æŸ¥çœ‹å€‹äººç°½åˆ°ç´€éŒ„</a>
            </div>
        </main>
    </div>

    <!-- QR Code Scanner Library -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <script type="module">
        // Firebase å»¶é²è¼‰å…¥ - åªåœ¨éœ€è¦æ™‚æ‰è¼‰å…¥
        let firebaseLoaded = false;

        async function loadFirebase() {
            if (firebaseLoaded) return;
            
            try {
                await import('/js/firebase-init.js');
                firebaseLoaded = true;
                console.log('âœ… Firebase å·²è¼‰å…¥');
            } catch (error) {
                console.error('âŒ Firebase è¼‰å…¥å¤±æ•—:', error);
                alert('ç³»çµ±è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
                throw error;
            }
        }

        // é é¢è¼‰å…¥æ™‚ç«‹å³è¼‰å…¥ Firebaseï¼ˆå› ç‚ºç°½åˆ°åŠŸèƒ½éœ€è¦èªè­‰ï¼‰
        (async function init() {
            await loadFirebase();
            // Firebase è¼‰å…¥å®Œæˆå¾Œï¼Œè¼‰å…¥ç°½åˆ°åŠŸèƒ½
            await import('/checkin/js/checkin.js');
        })();
    </script>
</body>
</html>
