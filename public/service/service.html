<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥å‹™æœå‹™ - é¾œé¦¬å±±æ•´åˆæœå‹™å¹³å°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/common.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div>
                <h1>ç¥å‹™æœå‹™</h1>
                <p class="subtitle">é¸æ“‡æ‚¨éœ€è¦çš„æœå‹™é …ç›®</p>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn-logout" onclick="window.location.href='/service/history.html'" style="background: #8A2BE2;">æˆ‘çš„å ±åè¨˜éŒ„</button>
                <button class="btn-logout" onclick="window.location.href='/'">è¿”å›é¦–é </button>
            </div>
        </header>

        <main class="main-content">
            <div class="module-grid active">
                <div class="module-card" onclick="checkServiceStatus('dd', 'DD.html')">
                    <div class="module-icon">ğŸ•¯ï¸</div>
                    <div class="module-title">é¾œé¦¬å±±ä¸€é»éˆ</div>
                    <div class="module-desc">ç¥ˆç¦é»ç‡ˆï¼Œå…‰æ˜ç¥ˆé¡˜</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('nd', 'ND.html')">
                    <div class="module-icon">ğŸŠ</div>
                    <div class="module-title">å¹´æ–—æ³•æœƒ</div>
                    <div class="module-desc">æ–°æ˜¥ç¥ˆç¦ï¼Œé—”å®¶å¹³å®‰</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('ld', 'LD.html')">
                    <div class="module-icon">â­</div>
                    <div class="module-title">ç¦®æ–—æ³•æœƒ</div>
                    <div class="module-desc">ç¦®æ‹œæ˜Ÿæ–—ï¼Œæ¶ˆç½å»¶å£½</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('zy', 'ZY.html')">
                    <div class="module-icon">ğŸ®</div>
                    <div class="module-title">ä¸­å…ƒæ³•æœƒ</div>
                    <div class="module-desc">æ™®æ¸¡çœ¾ç”Ÿï¼Œè¶…è–¦å…ˆéˆ</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('ps', 'PS.html')">
                    <div class="module-icon">ğŸ™</div>
                    <div class="module-title">æ™®æ–½æ³•æœƒ</div>
                    <div class="module-desc">æ…ˆæ‚²å¸ƒæ–½ï¼Œå»£çµå–„ç·£</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('qj', 'QJ.html')">
                    <div class="module-icon">ğŸ‚</div>
                    <div class="module-title">ç§‹ç¥­æ³•æœƒ</div>
                    <div class="module-desc">ç§‹å­£ç¥­å…¸ï¼Œæ„Ÿæ©ç¥ˆç¦</div>
                </div>
            </div>
        </main>

        <div class="bottom-nav">
            <div class="bottom-nav-items">
                <a href="/" class="bottom-nav-item">
                    <span class="icon">ğŸ </span>
                    <span>é¦–é </span>
                </a>
                <a href="/checkin/checkin.html" class="bottom-nav-item">
                    <span class="icon"><img src="/images/temple-icon.png" alt="ç°½åˆ°" style="width: 24px; height: 24px;"></span>
                    <span>ç°½åˆ°</span>
                </a>
                <a href="/service/history.html" class="bottom-nav-item">
                    <span class="icon">ğŸ“‹</span>
                    <span>å ±åè¨˜éŒ„</span>
                </a>
                <a href="/manage/index.html" class="bottom-nav-item">
                    <span class="icon">ğŸ””</span>
                    <span>é€šçŸ¥ä¸­å¿ƒ</span>
                </a>
            </div>
        </div>
    </div>

    <script type="module">
        console.log('âœ… ç¥å‹™æœå‹™é é¢å·²è¼‰å…¥');
        
        let serviceConfigs = {};
        const SERVICE_API_BASE = 'https://asia-east2-service-b9d4a.cloudfunctions.net';
        
        async function loadServiceConfigs() {
            try {
                const response = await fetch(`${SERVICE_API_BASE}/getServiceConfigs`);
                const result = await response.json();
                
                if (response.ok) {
                    serviceConfigs = result.result;
                    console.log('âœ… æœå‹™é…ç½®å·²è¼‰å…¥', serviceConfigs);
                } else {
                    console.error('è¼‰å…¥æœå‹™é…ç½®å¤±æ•—:', result);
                }
            } catch (error) {
                console.error('è¼‰å…¥æœå‹™é…ç½®å¤±æ•—:', error);
            }
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }
        
        window.checkServiceStatus = function(serviceType, targetPage) {
            const config = serviceConfigs[serviceType];
            
            if (!config) {
                window.location.href = targetPage;
                return;
            }
            
            if (!config.isOpen) {
                let message = 'æ­¤æœå‹™ç›®å‰æœªé–‹æ”¾å ±å';
                
                if (config.closedMessage) {
                    message += `\n\n${config.closedMessage}`;
                } else if (config.startDate) {
                    message += `\n\né è¨ˆ ${formatDate(config.startDate)} é–‹æ”¾`;
                }
                
                alert(message);
                return;
            }
            
            window.location.href = targetPage;
        };
        
        loadServiceConfigs();
    </script>
</body>
</html>
