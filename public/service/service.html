<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link rel="icon" type="image/png" href="/images/temple-icon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥å‹™æœå‹™ - é¾œé¦¬å±±æ•´åˆæœå‹™å¹³å°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/common.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div>
                <h1>ç¥å‹™æœå‹™</h1>
                <p class="subtitle">é¸æ“‡æ‚¨éœ€è¦çš„æœå‹™é …ç›®</p>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn-logout" onclick="window.location.href='/service/history.html'" style="background: #8A2BE2;">æˆ‘çš„å ±åè¨˜éŒ„</button>
                <button class="btn-logout" onclick="window.location.href='/'">è¿”å›é¦–é </button>
            </div>
        </header>

        <main class="main-content">
            <div class="module-grid active">
                <div class="module-card" onclick="checkServiceStatus('dd', 'DD.html')">
                    <div class="module-icon">ğŸ’¡</div>
                    <div class="module-title">é¾œé¦¬å±±ä¸€é»éˆ</div>
                    <div class="module-desc">ç¥ˆç¦é»ç‡ˆï¼Œå…‰æ˜ç¥ˆé¡˜</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('nd', 'ND.html')">
                    <div class="module-icon">ğŸŠ</div>
                    <div class="module-title">å¹´æ–—æ³•æœƒ</div>
                    <div class="module-desc">æ–°æ˜¥ç¥ˆç¦ï¼Œé—”å®¶å¹³å®‰</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('ld', 'LD.html')">
                    <div class="module-icon">â­</div>
                    <div class="module-title">ç¦®æ–—æ³•æœƒ</div>
                    <div class="module-desc">ç¦®æ‹œæ˜Ÿæ–—ï¼Œæ¶ˆç½å»¶å£½</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('zy', 'ZY.html')">
                    <div class="module-icon">ğŸ™</div>
                    <div class="module-title">ä¸­å…ƒæ³•æœƒ</div>
                    <div class="module-desc">æ™®æ¸¡çœ¾ç”Ÿï¼Œè¶…è–¦å…ˆéˆ</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('ps', 'PS.html')">
                    <div class="module-icon">ğŸ™</div>
                    <div class="module-title">æ™®æ–½æ³•æœƒ</div>
                    <div class="module-desc">æ…ˆæ‚²å¸ƒæ–½ï¼Œå»£çµå–„ç·£</div>
                </div>
                
                <div class="module-card" onclick="checkServiceStatus('qj', 'QJ.html')">
                    <div class="module-icon">ğŸ‚</div>
                    <div class="module-title">ç§‹ç¥­æ³•æœƒ</div>
                    <div class="module-desc">ç§‹å­£ç¥­å…¸ï¼Œæ„Ÿæ©ç¥ˆç¦</div>
                </div>
            </div>
        </main>

        <div class="bottom-nav">
            <div class="bottom-nav-items">
                <a href="/" class="bottom-nav-item">
                    <span class="icon">ğŸ </span>
                    <span>é¦–é </span>
                </a>
                <a href="/checkin/checkin.html" class="bottom-nav-item">
                    <span class="icon"><img src="/images/temple-icon.png" alt="ç°½åˆ°" style="width: 24px; height: 24px;"></span>
                    <span>ç°½åˆ°</span>
                </a>
                <a href="/service/history.html" class="bottom-nav-item">
                    <span class="icon">ğŸ“‹</span>
                    <span>å ±åè¨˜éŒ„</span>
                </a>
                <a href="/manage/index.html" class="bottom-nav-item">
                    <span class="icon">ğŸ””</span>
                    <span>é€šçŸ¥ä¸­å¿ƒ</span>
                </a>
            </div>
        </div>
    </div>

    <script type="module">
        console.log('âœ… ç¥å‹™æœå‹™é é¢å·²è¼‰å…¥');
        
        let serviceConfigs = {};
        const SERVICE_API_BASE = 'https://asia-east2-service-b9d4a.cloudfunctions.net';
        
        async function loadServiceConfigs() {
            try {
                const response = await fetch(`${SERVICE_API_BASE}/getServiceConfigs`);
                const result = await response.json();
                
                if (response.ok) {
                    serviceConfigs = result.result;
                    console.log('âœ… æœå‹™é…ç½®å·²è¼‰å…¥', serviceConfigs);
                } else {
                    console.error('è¼‰å…¥æœå‹™é…ç½®å¤±æ•—:', result);
                }
            } catch (error) {
                console.error('è¼‰å…¥æœå‹™é…ç½®å¤±æ•—:', error);
            }
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }
        
        function showServiceClosedNotification(config) {
            // å‰µå»ºé®ç½©å±¤
            const overlay = document.createElement('div');
            overlay.id = 'serviceClosedOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease-in-out;
            `;
            
            // å‰µå»ºé€šçŸ¥æ¡†
            const alertBox = document.createElement('div');
            alertBox.style.cssText = `
                background: white;
                padding: 2rem;
                border-radius: 12px;
                max-width: 450px;
                width: 90%;
                text-align: center;
                box-shadow: 0 10px 40px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease-out;
            `;
            
            // åœ–æ¨™
            const icon = document.createElement('div');
            icon.style.cssText = 'font-size: 4rem; margin-bottom: 1rem;';
            icon.textContent = 'âš ï¸';
            
            // æ¨™é¡Œ
            const title = document.createElement('h2');
            title.style.cssText = 'color: #E74C3C; margin-bottom: 1rem; font-size: 1.5rem; font-weight: 700;';
            title.textContent = 'æ­¤æœå‹™ç›®å‰æœªé–‹æ”¾å ±å';
            
            // è¨Šæ¯å…§å®¹
            const message = document.createElement('p');
            message.style.cssText = 'color: #666; margin-bottom: 1.5rem; line-height: 1.6; font-size: 1rem;';
            
            if (config.closedMessage) {
                message.textContent = config.closedMessage;
            } else if (config.startDate) {
                message.textContent = `é è¨ˆ ${formatDate(config.startDate)} é–‹æ”¾å ±å`;
            } else {
                message.textContent = 'æ•¬è«‹æœŸå¾…é–‹æ”¾æ™‚é–“';
            }
            
            // ç¢ºå®šæŒ‰éˆ•
            const button = document.createElement('button');
            button.style.cssText = `
                background: #8A2BE2;
                color: white;
                border: none;
                padding: 0.75rem 2rem;
                border-radius: 6px;
                font-size: 1rem;
                cursor: pointer;
                font-weight: 500;
                transition: background 0.2s;
            `;
            button.textContent = 'ç¢ºå®š';
            button.onmouseover = () => button.style.background = '#7B27C7';
            button.onmouseout = () => button.style.background = '#8A2BE2';
            button.onclick = () => {
                overlay.style.animation = 'fadeOut 0.2s ease-in-out';
                setTimeout(() => overlay.remove(), 200);
            };
            
            // çµ„è£é€šçŸ¥æ¡†
            alertBox.appendChild(icon);
            alertBox.appendChild(title);
            alertBox.appendChild(message);
            alertBox.appendChild(button);
            overlay.appendChild(alertBox);
            
            // æ·»åŠ  CSS å‹•ç•«
            if (!document.getElementById('notificationStyles')) {
                const style = document.createElement('style');
                style.id = 'notificationStyles';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                    @keyframes slideIn {
                        from { transform: translateY(-50px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // é¡¯ç¤ºé€šçŸ¥
            document.body.insertBefore(overlay, document.body.firstChild);
            
            // é»æ“Šé®ç½©å±¤ä¹Ÿå¯ä»¥é—œé–‰
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    overlay.style.animation = 'fadeOut 0.2s ease-in-out';
                    setTimeout(() => overlay.remove(), 200);
                }
            };
        }
        
        window.checkServiceStatus = function(serviceType, targetPage) {
            const config = serviceConfigs[serviceType];
            
            if (!config) {
                window.location.href = targetPage;
                return;
            }
            
            if (!config.isOpen) {
                showServiceClosedNotification(config);
                return;
            }
            
            window.location.href = targetPage;
        };
        
        loadServiceConfigs();
    </script>
</body>
</html>
