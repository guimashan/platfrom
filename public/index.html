<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾œé¦¬å±±æ•´åˆæœå‹™å¹³å°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/common.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div>
                <h1>é¾œé¦¬å±±æ•´åˆæœå‹™å¹³å°</h1>
            </div>
            <button id="logoutBtn" class="btn-logout" style="display: none;">ç™»å‡º</button>
        </header>

        <main class="main-content">
            <div id="userInfo" class="user-info" style="display: none;">
                <img id="userAvatar" class="user-avatar" alt="ä½¿ç”¨è€…é ­åƒ">
                <div class="user-details">
                    <h3 id="userName"></h3>
                    <div id="userRoles" class="user-roles"></div>
                </div>
            </div>

            <div id="loginCard" class="welcome-card">
                <h2>æ­¡è¿</h2>
                <p style="color: #6B5D4F; margin-bottom: 2rem;">è«‹ä½¿ç”¨ LINE å¸³è™Ÿç™»å…¥ç³»çµ±</p>
                <button id="lineLoginBtn" class="btn btn-primary">
                    LINE ç™»å…¥
                </button>
            </div>

            <div id="moduleGrid" class="module-grid">
                <div class="module-card" data-module="checkin">
                    <div class="module-icon">ğŸ™</div>
                    <div class="module-title">å¥‰é¦™ç°½åˆ°</div>
                    <div class="module-desc">ç°½åˆ°æ‰“å¡èˆ‡æ­·ç¨‹ç´€éŒ„</div>
                </div>
                
                <div class="module-card" data-module="service">
                    <div class="module-icon">âš¡</div>
                    <div class="module-title">ç¥å‹™æœå‹™</div>
                    <div class="module-desc">æ³•æœƒå ±åèˆ‡æœå‹™ç®¡ç†</div>
                </div>
                
                <div class="module-card module-card-locked" data-module="schedule">
                    <div class="module-badge">å³å°‡é–‹æ”¾</div>
                    <div class="module-icon">ğŸ“…</div>
                    <div class="module-title">æ’ç­ç³»çµ±</div>
                    <div class="module-desc">å¿—å·¥æ’ç­èˆ‡ç­è¡¨ç®¡ç†</div>
                </div>
                
                <div class="module-card" data-module="manage" style="display: none;">
                    <div class="module-icon">âš™ï¸</div>
                    <div class="module-title">ç³»çµ±ç®¡ç†</div>
                    <div class="module-desc">ä½¿ç”¨è€…èˆ‡æ¬Šé™ç®¡ç†</div>
                </div>
            </div>

            <div id="loadingIndicator" class="loading hidden">
                <div class="spinner"></div>
                <p>ç™»å…¥ä¸­...</p>
            </div>
        </main>

        <div class="bottom-nav">
            <div class="bottom-nav-items">
                <a href="/" class="bottom-nav-item active">
                    <span class="icon">ğŸ </span>
                    <span>é¦–é </span>
                </a>
                <a href="/checkin/checkin.html" class="bottom-nav-item">
                    <span class="icon"><img src="/images/temple-icon.png" alt="ç°½åˆ°" style="width: 24px; height: 24px;"></span>
                    <span>ç°½åˆ°</span>
                </a>
                <a href="/checkin/history.html" class="bottom-nav-item">
                    <span class="icon">ğŸ“‹</span>
                    <span>æ­·ç¨‹è¡¨</span>
                </a>
                <a href="/manage/index.html" class="bottom-nav-item">
                    <span class="icon">ğŸ””</span>
                    <span>é€šçŸ¥ä¸­å¿ƒ</span>
                </a>
            </div>
        </div>
    </div>

    <script type="module" src="/js/firebase-init.js"></script>
    <script type="module" src="/js/auth.js"></script>
    <script>
        // æª¢æŸ¥ liff.state åƒæ•¸ä¸¦è‡ªå‹•è·³è½‰
        (function() {
            const queryString = decodeURIComponent(window.location.search);
            console.log('é¦–é æª¢æ¸¬åˆ° query string:', queryString);
            
            if (queryString.includes('liff.state=')) {
                const cleaned = queryString.replace('?liff.state=', '');
                console.log('æª¢æ¸¬åˆ° liff.state åƒæ•¸:', cleaned);
                
                // å¦‚æœæ˜¯ç›´æ¥è·¯å¾‘ï¼ˆä»¥ / é–‹é ­ï¼‰ï¼Œç›´æ¥è·³è½‰
                if (cleaned.startsWith('/')) {
                    console.log('è‡ªå‹•è·³è½‰åˆ°:', cleaned);
                    window.location.href = cleaned;
                }
                // å¦‚æœæ˜¯æŸ¥è©¢åƒæ•¸æ ¼å¼ï¼ˆ?module=xxxï¼‰ï¼Œè·³è½‰åˆ° /liff/
                else if (cleaned.startsWith('?')) {
                    console.log('è‡ªå‹•è·³è½‰åˆ° LIFF å…¥å£:', '/liff/' + cleaned);
                    window.location.href = '/liff/' + cleaned;
                }
            }
        })();
    </script>
</body>
</html>
