rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // 輔助函數：檢查用戶是否已認證
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // 巡邏點 (patrols)
    match /patrols/{patrolId} {
      // 所有已登入用戶可以讀取巡邏點（簽到時需要）
      allow read: if isAuthenticated();
      // 所有已登入用戶可以寫入（由前端 JavaScript 控制實際權限）
      allow write: if isAuthenticated();
    }
    
    // 簽到紀錄 (checkins)
    match /checkins/{checkinId} {
      // 所有已登入用戶可以讀取簽到記錄（管理員需要查看統計）
      allow read: if isAuthenticated();
      // 允許創建簽到記錄
      allow create: if isAuthenticated();
      // 允許更新和刪除（由前端 JavaScript 控制實際權限）
      allow update, delete: if isAuthenticated();
    }
    
    // 系統設定 (settings)
    match /settings/{settingId} {
      // 所有已登入用戶可以讀取設定（例如測試模式狀態）
      allow read: if isAuthenticated();
      // 允許寫入（由前端 JavaScript 控制實際權限）
      allow write: if isAuthenticated();
    }
  }
}
